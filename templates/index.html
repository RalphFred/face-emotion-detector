<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Face Emotion — Analyze & Save</title>
    <meta name="description" content="Upload a face photo and detect the emotion using a trained model.">
    <style>
        /* Clean, bright redesign — looks and structure different from original */
        :root{
            --bg:#f6fbff;
            --card:#ffffff;
            --muted:#6b7280;
            --accent:#06b6d4; /* teal */
            --accent-2:#7c3aed; /* purple */
            --shadow: 0 8px 30px rgba(16,24,40,0.06);
            --radius:14px;
            --text:#0f172a;
        }
        *{box-sizing:border-box}
        html,body{height:100%}
        body{
            margin:0; font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            background: linear-gradient(180deg, #eaf6fb 0%, #ffffff 50%); color:var(--text);
            display:flex; align-items:center; justify-content:center; padding:36px;
        }

        .wrap{width:100%; max-width:980px}
        header{display:flex; align-items:center; gap:16px; margin-bottom:18px}
        .brand{display:flex; gap:12px; align-items:center}
        .logo{width:48px; height:48px; border-radius:10px; background:linear-gradient(135deg,var(--accent), var(--accent-2)); display:flex; align-items:center; justify-content:center; color:white; font-weight:700}
        h1{font-size:20px; margin:0}
        p.lead{margin:0; color:var(--muted); font-size:13px}

        .card{background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:22px; border:1px solid rgba(15,23,42,0.04)}
        .grid{display:grid; grid-template-columns: 1fr 360px; gap:18px; align-items:start}
        .grid.no-preview{grid-template-columns: 1fr}

        /* Upload area */
        .uploader{border:2px dashed rgba(99,102,241,0.12); border-radius:12px; padding:18px; display:flex; gap:16px; align-items:center; flex-wrap:wrap}
        .uploader.dragover{background:linear-gradient(90deg, rgba(6,182,212,0.03), rgba(124,58,237,0.02)); border-color:rgba(6,182,212,0.28)}
        .uploader .info{flex:1; min-width:220px}
        .uploader .info strong{display:block; color:var(--text); font-size:15px}
        .uploader small{color:var(--muted); display:block; margin-top:4px}
        .controls{display:flex; gap:10px; align-items:center; flex-wrap:wrap}

        input[type=file]{display:none}
        .btn{background:linear-gradient(180deg,var(--accent), var(--accent-2)); color:white; border:none; padding:10px 14px; border-radius:10px; cursor:pointer}
        .btn.ghost{background:transparent; color:var(--accent-2); border:1px solid rgba(124,58,237,0.12)}

        /* Preview/result panel */
        .panel{background:linear-gradient(180deg,#fbfdff, #ffffff); border-radius:12px; padding:14px; border:1px solid rgba(15,23,42,0.03)}
        .panel.hidden{display:none}
        .preview{width:100%; height:260px; display:flex; align-items:center; justify-content:center; border-radius:8px; background:linear-gradient(180deg,#f8fafc,#ffffff); border:1px solid rgba(99,102,241,0.04); overflow:hidden}
        .preview img{max-width:100%; max-height:100%; object-fit:contain}
        .meta{margin-top:12px; display:flex; justify-content:space-between; align-items:center; gap:8px}
        .prediction{font-weight:600; color:var(--accent-2)}
        .saved{color:var(--muted); font-size:13px}

        footer{margin-top:14px; text-align:right; color:var(--muted); font-size:12px}

        @media(max-width:880px){
            .grid{grid-template-columns:1fr}
            .uploader{flex-direction:column; align-items:stretch}
            .uploader .info{text-align:center}
            .controls{flex-direction:column; width:100%}
            .controls button{width:100%}
            .preview{height:240px}
        }
        
        @media(max-width:520px){
            body{padding:16px}
            .card{padding:16px}
            header{flex-direction:column; align-items:flex-start}
            .brand{flex-direction:column; align-items:flex-start; gap:8px}
            .logo{width:40px; height:40px}
            h1{font-size:18px}
            .preview{height:200px}
        }
    </style>
    <script>
        // Small client-side preview + drag/drop — non-intrusive and progressive
        document.addEventListener('DOMContentLoaded', function(){
            const drop = document.getElementById('dropzone');
            const fileInput = document.getElementById('file-input');
            const filename = document.getElementById('filename');
            const imgPreview = document.getElementById('img-preview');
            const submitBtn = document.getElementById('submit-btn');
            const form = document.getElementById('frm');
            const grid = document.getElementById('main-grid');
            const panel = document.getElementById('preview-panel');

            // Hide preview panel initially if no server image
            if (panel.dataset.hidden === 'true') {
                panel.classList.add('hidden');
                grid.classList.add('no-preview');
            }

            function showFile(file){
                filename.textContent = file.name;
                const reader = new FileReader();
                reader.onload = function(e){ 
                    imgPreview.src = e.target.result; 
                    imgPreview.alt = file.name;
                    // Show panel when image is selected
                    panel.classList.remove('hidden');
                    grid.classList.remove('no-preview');
                }
                reader.readAsDataURL(file);
            }

            drop.addEventListener('click', ()=> fileInput.click());
            drop.addEventListener('dragover', e=>{ e.preventDefault(); drop.classList.add('dragover') });
            drop.addEventListener('dragleave', ()=> drop.classList.remove('dragover'));
            drop.addEventListener('drop', e=>{
                e.preventDefault(); drop.classList.remove('dragover');
                const f = e.dataTransfer.files && e.dataTransfer.files[0];
                if(f){ fileInput.files = e.dataTransfer.files; showFile(f) }
            });

            fileInput.addEventListener('change', ()=>{
                const f = fileInput.files && fileInput.files[0];
                if(f) showFile(f);
            });

            // show spinner on submit to give feedback
            form.addEventListener('submit', ()=>{
                submitBtn.disabled = true;
                submitBtn.textContent = 'Analyzing…';
            });
        });
    </script>
</head>
<body>
    <div class="wrap">
        <header>
            <div class="brand">
                <div class="logo">FE</div>
                <div>
                    <h1>Face Emotion</h1>
                    <p class="lead">Upload a clear face photo. The model will detect the emotion and save the image.</p>
                </div>
            </div>
        </header>

        <main class="card">
            <div id="main-grid" class="grid">
                <section>
                    <form id="frm" action="/predict" method="post" enctype="multipart/form-data" aria-label="Upload image form">
                        <label id="dropzone" class="uploader" for="file-input" role="button" tabindex="0" aria-haspopup="true">
                            <div class="info">
                                <strong>Drop an image here or click to browse</strong>
                                <small>PNG or JPG preferred. Grayscale 48×48 works best but larger photos are fine.</small>
                            </div>
                            <div class="controls">
                                <span id="filename" class="saved">No file chosen</span>
                                <button type="button" class="btn ghost" onclick="document.getElementById('file-input').click()">Browse</button>
                            </div>
                        </label>
                        <input id="file-input" name="imagefile" type="file" accept="image/*" required>

                        <div style="margin-top:12px; display:flex; gap:10px; align-items:center; flex-wrap:wrap">
                            <button id="submit-btn" class="btn" type="submit">Detect Emotion</button>
                            <button type="reset" class="btn ghost" onclick="document.getElementById('img-preview').src='';document.getElementById('filename').textContent='No file chosen';document.getElementById('preview-panel').classList.add('hidden');document.getElementById('main-grid').classList.add('no-preview')">Reset</button>
                        </div>
                    </form>

                    {% if prediction %}
                    <div style="margin-top:18px; padding:16px; background:linear-gradient(135deg,rgba(6,182,212,0.08),rgba(124,58,237,0.06)); border-radius:12px; border:1px solid rgba(124,58,237,0.15)">
                        <div style="display:flex; align-items:center; gap:12px">
                            <div style="width:8px; height:8px; border-radius:50%; background:var(--accent-2)"></div>
                            <div style="font-size:18px; font-weight:600; color:var(--accent-2)">{{ prediction }}</div>
                        </div>
                    </div>
                    {% endif %}
                </section>

                <aside id="preview-panel" class="panel"{% if not image %} data-hidden="true"{% endif %}>
                    <div class="preview" aria-live="polite">
                        <img id="img-preview" src="{% if image %}{{ image }}{% endif %}" alt="{% if image %}Preview{% endif %}">
                    </div>
                    <div class="meta">
                        <div class="saved">Tip: crop to face for best results</div>
                        <div style="font-size:13px; color:var(--muted)">Model: <strong>custom CNN</strong></div>
                    </div>
                </aside>
            </div>
            <footer>Built by Kwaghuter Raphael</footer>
        </main>
    </div>
</body>
</html>
